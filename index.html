<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ATASK - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#ffffff">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/906/906334.png">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Tajawal:wght@300;400;500;700&display=swap');

        :root {
            --primary: #6366f1;
            --primary-gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            --bg: #f8fafc;
            --surface: #ffffff;
            --text-main: #1e293b;
            --text-sec: #64748b;
            --danger: #ef4444;
            --success: #10b981;
            --radius: 24px;
            --shadow: 0 10px 30px -10px rgba(99, 102, 241, 0.2);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Tajawal', 'Outfit', sans-serif; }
        body { margin: 0; padding: 0; background-color: var(--bg); color: var(--text-main); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* --- Auth --- */
        #auth-screen { position: fixed; inset: 0; background: white; z-index: 200; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px; overflow-y: auto; }
        .logo-large { width: 80px; height: 80px; background: var(--primary-gradient); border-radius: 24px; display: flex; align-items: center; justify-content: center; font-size: 40px; color: white; margin-bottom: 20px; box-shadow: var(--shadow); }
        .auth-tabs { display: flex; background: #f1f5f9; padding: 5px; border-radius: 16px; margin-bottom: 25px; width: 100%; max-width: 350px; }
        .auth-tab { flex: 1; padding: 12px; border: none; background: none; border-radius: 12px; font-weight: bold; color: var(--text-sec); cursor: pointer; transition: 0.3s; }
        .auth-tab.active { background: white; color: var(--primary); box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .input-box { width: 100%; background: #f8fafc; border: 2px solid #e2e8f0; padding: 16px; border-radius: 16px; font-size: 15px; margin-bottom: 12px; outline: none; transition: 0.3s; text-align: right; }
        .input-box:focus { background: white; border-color: var(--primary); }
        .btn-main { width: 100%; padding: 16px; background: var(--primary-gradient); color: white; border: none; border-radius: 16px; font-size: 16px; font-weight: bold; cursor: pointer; box-shadow: var(--shadow); margin-top: 10px; }
        .btn-main:active { transform: scale(0.98); }

        /* --- App --- */
        #app-screen { display: none; flex-direction: column; height: 100%; }
        header { padding: 20px 25px; padding-top: max(20px, env(safe-area-inset-top)); background: rgba(255,255,255,0.8); backdrop-filter: blur(20px); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 50; }
        .app-logo { font-family: 'Outfit', sans-serif; font-weight: 800; font-size: 24px; background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        main { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 120px; }
        .section-title { font-size: 20px; font-weight: 800; margin-bottom: 15px; color: var(--text-main); display: flex; justify-content: space-between; align-items: center; }
        .filter-badge { font-size: 12px; background: var(--primary); color: white; padding: 4px 10px; border-radius: 20px; display: none; }

        /* --- Stats --- */
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 25px; }
        .stat-card { background: white; padding: 15px; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); text-align: center; cursor: pointer; border: 2px solid transparent; transition: 0.2s; }
        .stat-card.active { border-color: var(--primary); background: #e0e7ff; }
        .stat-value { font-size: 22px; font-weight: 800; color: var(--text-main); }
        .stat-label { font-size: 12px; color: var(--text-sec); }

        /* --- Tasks --- */
        .task-card { background: white; padding: 18px; border-radius: 20px; margin-bottom: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.03); position: relative; border: 1px solid #f1f5f9; }
        .task-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
        .task-badges { display: flex; gap: 6px; flex-wrap: wrap; }
        .badge { padding: 4px 8px; border-radius: 6px; font-size: 10px; font-weight: bold; }
        .b-high { background: #fee2e2; color: #ef4444; }
        .b-medium { background: #ffedd5; color: #f97316; }
        .b-low { background: #dcfce7; color: #16a34a; }
        .b-todo { background: #f1f5f9; color: #64748b; }
        .b-doing { background: #dbeafe; color: #2563eb; }
        .b-done { background: #dcfce7; color: #16a34a; }

        .task-title { font-weight: 700; font-size: 16px; margin-bottom: 5px; }
        .task-desc { font-size: 13px; color: var(--text-sec); margin-bottom: 10px; line-height: 1.4; }
        .task-dates { font-size: 11px; color: var(--info); background: #eff6ff; padding: 8px; border-radius: 8px; margin-bottom: 10px; display: flex; flex-direction: column; gap: 4px; }
        
        .task-attachments { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; margin-bottom: 10px; }
        .attachment-thumb { width: 50px; height: 50px; border-radius: 10px; object-fit: cover; border: 1px solid #e2e8f0; }

        .task-actions { display: flex; gap: 10px; border-top: 1px solid #f1f5f9; padding-top: 12px; margin-top: 5px; }
        .action-btn { flex: 1; padding: 8px; border-radius: 10px; border: none; font-size: 12px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .btn-edit { background: #f1f5f9; color: var(--text-main); }
        .btn-cal { background: #f0fdf4; color: #16a34a; }
        .btn-del { background: #fef2f2; color: #ef4444; }

        /* --- Nav --- */
        .nav-bar { position: fixed; bottom: 20px; left: 20px; right: 20px; background: rgba(255,255,255,0.95); backdrop-filter: blur(20px); padding: 12px; border-radius: 25px; display: flex; justify-content: space-around; box-shadow: 0 10px 40px rgba(0,0,0,0.1); z-index: 100; }
        .nav-btn { background: none; border: none; color: #94a3b8; font-size: 22px; padding: 10px; border-radius: 15px; transition: 0.3s; }
        .nav-btn.active { color: var(--primary); background: #e0e7ff; }
        .fab-main { position: absolute; top: -25px; left: 50%; transform: translateX(-50%); width: 55px; height: 55px; background: var(--text-main); border-radius: 50%; color: white; font-size: 28px; display: flex; align-items: center; justify-content: center; box-shadow: 0 10px 30px rgba(30, 41, 59, 0.4); border: 4px solid var(--bg); cursor: pointer; }

        /* --- Modal --- */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); z-index: 200; display: none; align-items: flex-end; }
        .modal-overlay.open { display: flex; }
        .sheet { background: white; width: 100%; border-radius: 30px 30px 0 0; padding: 25px; max-height: 90vh; overflow-y: auto; animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        .form-label { font-size: 12px; font-weight: bold; color: var(--text-main); margin-bottom: 5px; display: block; }
        .row { display: flex; gap: 10px; }
        .col { flex: 1; }

        .view-section { display: none; }
        .view-section.active { display: block; }
    </style>
</head>
<body>

    <!-- Auth -->
    <div id="auth-screen">
        <div class="logo-large">A</div>
        <h1 style="margin-bottom: 20px;">ATASK</h1>
        <div class="auth-tabs">
            <button class="auth-tab active" onclick="switchAuthMode('login')">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>
            <button class="auth-tab" onclick="switchAuthMode('signup')">Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</button>
        </div>
        <div id="error-msg" style="color:red; font-size:12px; margin-bottom:10px; display:none;"></div>
        <form onsubmit="handleAuth(event)" style="width:100%; max-width:350px;">
            <input type="text" id="auth-name" class="input-box" placeholder="Ø§Ù„Ø§Ø³Ù…" style="display:none;">
            <input type="email" id="auth-email" class="input-box" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required dir="ltr">
            <input type="password" id="auth-password" class="input-box" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required dir="ltr">
            <button type="submit" class="btn-main" id="auth-btn">Ø¯Ø®ÙˆÙ„</button>
        </form>
    </div>

    <!-- App -->
    <div id="app-screen">
        <header>
            <div class="app-logo">ATASK.</div>
            <div style="font-size:14px; font-weight:bold;" id="header-name"></div>
        </header>

        <main>
            <!-- Tasks View -->
            <div id="view-tasks" class="view-section active">
                <div class="stats-grid">
                    <div class="stat-card" onclick="filterTasks('doing')" id="card-doing">
                        <div class="stat-value" id="s-doing">0</div>
                        <div class="stat-label">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¹Ù…Ù„</div>
                    </div>
                    <div class="stat-card" onclick="filterTasks('done')" id="card-done">
                        <div class="stat-value" id="s-done">0</div>
                        <div class="stat-label">Ù…ÙƒØªÙ…Ù„Ø©</div>
                    </div>
                    <div class="stat-card" onclick="filterTasks('high')" id="card-high">
                        <div class="stat-value" id="s-high">0</div>
                        <div class="stat-label">Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø£Ù‡Ù…ÙŠØ©</div>
                    </div>
                    <div class="stat-card active" onclick="filterTasks('all')" id="card-all">
                        <div class="stat-value" id="s-total">0</div>
                        <div class="stat-label">Ø§Ù„ÙƒÙ„</div>
                    </div>
                </div>

                <div class="section-title">
                    <span>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù…</span>
                    <span id="current-filter" class="filter-badge" style="display:inline-block;">Ø§Ù„ÙƒÙ„</span>
                </div>
                <div id="tasks-container"></div>
            </div>

            <!-- Settings View -->
            <div id="view-settings" class="view-section">
                <div class="section-title">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
                <button class="btn-main" onclick="logout()" style="background:var(--danger); margin-bottom:10px;">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
                <button class="btn-main" onclick="clearData()" style="background:#cbd5e1; color:#334155;">Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            </div>
        </main>

        <nav class="nav-bar">
            <button class="nav-btn active" onclick="switchView('tasks', this)">ğŸ </button>
            <div class="fab-main" onclick="openModal()">+</div>
            <button class="nav-btn" onclick="switchView('settings', this)">âš™ï¸</button>
        </nav>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="task-modal">
        <div class="sheet">
            <h2 style="margin-top:0;" id="modal-title">Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
            <input type="hidden" id="t-id">
            
            <label class="form-label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
            <input type="text" id="t-title" class="input-box" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©">
            
            <label class="form-label">Ø§Ù„ÙˆØµÙ ÙˆØ§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
            <textarea id="t-desc" class="input-box" rows="3" placeholder="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©..."></textarea>

            <div class="row">
                <div class="col">
                    <label class="form-label">Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</label>
                    <input type="datetime-local" id="t-start" class="input-box" style="font-size:12px;">
                </div>
                <div class="col">
                    <label class="form-label">Ø§Ù„Ù†Ù‡Ø§ÙŠØ©</label>
                    <input type="datetime-local" id="t-end" class="input-box" style="font-size:12px;">
                </div>
            </div>

            <div class="row">
                <div class="col">
                    <label class="form-label">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                    <select id="t-priority" class="input-box">
                        <option value="low">Ø¹Ø§Ø¯ÙŠØ©</option>
                        <option value="medium">Ù…ØªÙˆØ³Ø·Ø©</option>
                        <option value="high">Ø¹Ø§Ù„ÙŠØ© ğŸ”¥</option>
                    </select>
                </div>
                <div class="col">
                    <label class="form-label">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                    <select id="t-status" class="input-box">
                        <option value="todo">Ø¬Ø¯ÙŠØ¯Ø©</option>
                        <option value="doing">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¹Ù…Ù„</option>
                        <option value="done">Ù…ÙƒØªÙ…Ù„Ø©</option>
                    </select>
                </div>
            </div>

            <label class="form-label">Ù…Ø±ÙÙ‚Ø§Øª (ØµÙˆØ± ÙÙ‚Ø·)</label>
            <input type="file" id="t-file" class="input-box" accept="image/*">
            <div id="file-preview" style="margin-bottom:10px;"></div>

            <button class="btn-main" onclick="saveTask()">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
            <button style="width:100%; padding:15px; border:none; background:none; margin-top:5px;" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <script>
        // --- Logic ---
        let authMode = 'login';
        let currentUser = JSON.parse(localStorage.getItem('atask_current_user'));
        let tasks = JSON.parse(localStorage.getItem('atask_data')) || [];
        let currentFilter = 'all';
        let tempAttachment = null;

        if (currentUser) initApp();

        // Auth
        function switchAuthMode(mode) {
            authMode = mode;
            document.querySelectorAll('.auth-tab').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('auth-name').style.display = mode === 'signup' ? 'block' : 'none';
            document.getElementById('auth-btn').innerText = mode === 'signup' ? 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨' : 'Ø¯Ø®ÙˆÙ„';
        }

        function handleAuth(e) {
            e.preventDefault();
            const email = document.getElementById('auth-email').value.toLowerCase();
            const password = document.getElementById('auth-password').value;
            const name = document.getElementById('auth-name').value;
            let users = JSON.parse(localStorage.getItem('atask_users')) || [];

            if (authMode === 'signup') {
                if(users.find(u=>u.email===email)) return alert('Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹');
                const user = {name, email, password};
                users.push(user);
                localStorage.setItem('atask_users', JSON.stringify(users));
                loginUser(user);
            } else {
                const user = users.find(u=>u.email===email && u.password===password);
                if(user) loginUser(user);
                else alert('Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø©');
            }
        }

        function loginUser(user) {
            localStorage.setItem('atask_current_user', JSON.stringify(user));
            currentUser = user;
            initApp();
        }

        function initApp() {
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('app-screen').style.display = 'flex';
            document.getElementById('header-name').innerText = currentUser.name;
            renderTasks();
            updateStats();
        }

        function logout() { localStorage.removeItem('atask_current_user'); location.reload(); }

        // File Handling
        document.getElementById('t-file').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            if (file.size > 500000) return alert('Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹. Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 0.5 Ù…ÙŠØ¬Ø§'); // 500KB limit
            
            const reader = new FileReader();
            reader.onload = function(evt) {
                tempAttachment = evt.target.result;
                document.getElementById('file-preview').innerHTML = `<img src="${tempAttachment}" style="height:60px; border-radius:10px;">`;
            };
            reader.readAsDataURL(file);
        });

        // Tasks
        function openModal(id = null) {
            document.getElementById('task-modal').classList.add('open');
            tempAttachment = null;
            document.getElementById('file-preview').innerHTML = '';
            
            if (id) {
                const t = tasks.find(x => x.id === id);
                document.getElementById('modal-title').innerText = 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©';
                document.getElementById('t-id').value = t.id;
                document.getElementById('t-title').value = t.title;
                document.getElementById('t-desc').value = t.desc;
                document.getElementById('t-start').value = t.startDate || '';
                document.getElementById('t-end').value = t.endDate || '';
                document.getElementById('t-priority').value = t.priority;
                document.getElementById('t-status').value = t.status;
                if(t.attachment) {
                    tempAttachment = t.attachment;
                    document.getElementById('file-preview').innerHTML = `<img src="${t.attachment}" style="height:60px; border-radius:10px;">`;
                }
            } else {
                document.getElementById('modal-title').innerText = 'Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©';
                document.getElementById('t-id').value = '';
                document.getElementById('t-title').value = '';
                document.getElementById('t-desc').value = '';
                document.getElementById('t-start').value = '';
                document.getElementById('t-end').value = '';
            }
        }

        function closeModal() { document.getElementById('task-modal').classList.remove('open'); }

        function saveTask() {
            const id = document.getElementById('t-id').value;
            const title = document.getElementById('t-title').value;
            if(!title) return;

            const taskData = {
                id: id ? parseInt(id) : Date.now(),
                title,
                desc: document.getElementById('t-desc').value,
                startDate: document.getElementById('t-start').value,
                endDate: document.getElementById('t-end').value,
                priority: document.getElementById('t-priority').value,
                status: document.getElementById('t-status').value,
                attachment: tempAttachment
            };

            if (id) {
                const idx = tasks.findIndex(t => t.id == id);
                tasks[idx] = taskData;
            } else {
                tasks.unshift(taskData);
            }

            localStorage.setItem('atask_data', JSON.stringify(tasks));
            renderTasks();
            updateStats();
            closeModal();
        }

        function deleteTask(id) {
            if(confirm('Ø­Ø°ÙØŸ')) {
                tasks = tasks.filter(t => t.id !== id);
                localStorage.setItem('atask_data', JSON.stringify(tasks));
                renderTasks();
                updateStats();
            }
        }

        function addToCalendar(id) {
            const t = tasks.find(x => x.id === id);
            if (!t.startDate || !t.endDate) return alert('ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ¯ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹');
            
            // Simple ICS generation
            const format = (dateStr) => dateStr.replace(/[-:]/g, '').replace('T', 'T') + '00';
            const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
SUMMARY:${t.title}
DESCRIPTION:${t.desc}
DTSTART:${format(t.startDate)}
DTEND:${format(t.endDate)}
END:VEVENT
END:VCALENDAR`;

            const blob = new Blob([icsContent], { type: 'text/calendar' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'task.ics';
            a.click();
        }

        // Filtering
        function filterTasks(filter) {
            currentFilter = filter;
            document.querySelectorAll('.stat-card').forEach(c => c.classList.remove('active'));
            document.getElementById('card-'+filter).classList.add('active');
            
            const labels = {all:'Ø§Ù„ÙƒÙ„', doing:'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¹Ù…Ù„', done:'Ù…ÙƒØªÙ…Ù„Ø©', high:'Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø£Ù‡Ù…ÙŠØ©'};
            document.getElementById('current-filter').innerText = labels[filter];
            
            renderTasks();
        }

        function renderTasks() {
            const container = document.getElementById('tasks-container');
            container.innerHTML = '';

            let filtered = tasks;
            if (currentFilter === 'doing') filtered = tasks.filter(t => t.status === 'doing');
            if (currentFilter === 'done') filtered = tasks.filter(t => t.status === 'done');
            if (currentFilter === 'high') filtered = tasks.filter(t => t.priority === 'high');

            if (filtered.length === 0) {
                container.innerHTML = '<div style="text-align:center; padding:30px; color:#94a3b8">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù…</div>';
                return;
            }

            filtered.forEach(t => {
                const pLabels = {high:'Ø¹Ø§Ù„ÙŠØ© ğŸ”¥', medium:'Ù…ØªÙˆØ³Ø·Ø©', low:'Ø¹Ø§Ø¯ÙŠØ©'};
                const sLabels = {todo:'Ø¬Ø¯ÙŠØ¯Ø©', doing:'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¹Ù…Ù„', done:'Ù…ÙƒØªÙ…Ù„Ø©'};
                
                let datesHtml = '';
                if(t.startDate || t.endDate) {
                    datesHtml = `<div class="task-dates">
                        ${t.startDate ? `<span>ğŸ“… Ù…Ù†: ${t.startDate.replace('T', ' ')}</span>` : ''}
                        ${t.endDate ? `<span>ğŸ Ø¥Ù„Ù‰: ${t.endDate.replace('T', ' ')}</span>` : ''}
                    </div>`;
                }

                let imgHtml = t.attachment ? `<div class="task-attachments"><img src="${t.attachment}" class="attachment-thumb" onclick="alert('ØµÙˆØ±Ø© Ù…Ø±ÙÙ‚Ø©')"></div>` : '';

                container.innerHTML += `
                    <div class="task-card">
                        <div class="task-header">
                            <div class="task-badges">
                                <span class="badge b-${t.priority}">${pLabels[t.priority]}</span>
                                <span class="badge b-${t.status}">${sLabels[t.status]}</span>
                            </div>
                        </div>
                        <div class="task-title">${t.title}</div>
                        <div class="task-desc">${t.desc}</div>
                        ${datesHtml}
                        ${imgHtml}
                        <div class="task-actions">
                            <button class="action-btn btn-edit" onclick="openModal(${t.id})">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
                            <button class="action-btn btn-cal" onclick="addToCalendar(${t.id})">ğŸ“… ØªÙ‚ÙˆÙŠÙ…</button>
                            <button class="action-btn btn-del" onclick="deleteTask(${t.id})">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                        </div>
                    </div>
                `;
            });
        }

        function updateStats() {
            document.getElementById('s-doing').innerText = tasks.filter(t=>t.status==='doing').length;
            document.getElementById('s-done').innerText = tasks.filter(t=>t.status==='done').length;
            document.getElementById('s-high').innerText = tasks.filter(t=>t.priority==='high').length;
            document.getElementById('s-total').innerText = tasks.length;
        }

        function switchView(v, b) {
            document.querySelectorAll('.view-section').forEach(e=>e.classList.remove('active'));
            document.getElementById('view-'+v).classList.add('active');
            if(b){
                document.querySelectorAll('.nav-btn').forEach(e=>e.classList.remove('active'));
                b.classList.add('active');
            }
        }
        function clearData() { if(confirm('Ø­Ø°Ù Ø§Ù„ÙƒÙ„ØŸ')) { localStorage.clear(); location.reload(); } }
    </script>
</body>
</html>
